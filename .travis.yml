language: ruby
dist: trusty
rvm:
  - 2.5.3
services:
  - postgresql
addons:
  postgresql: "12"
  apt:
    packages:
    - postgresql-12
    - postgresql-client-12
env:
  - "rack=master"
  global:
  - PGPORT=5432
before_install:
  - gem install bundler
install: 
  - "echo 'gem: --no-ri --no-rdoc' > ~/.gemrc"
  - gem update --system
  - gem install rails
  - bundle install
before_script:
  - psql -c 'create role railsdb with createdb login password;' -U 123@456
script:
  - rails db:drop
  - rails db:create
  - rails db:migrate RAILS_ENV=test
  - rails dev:setup RAILS_ENV=test
  - rspec